# Railway Monorepo Configuration - Nixpacks
# Tek Railway service'te hem backend hem frontend çalışır

[build]
builder = "nixpacks"

[build.nixpacksPlan.phases.setup]
nixPkgs = ["nodejs-20_x", "npm-10_x"]

[build.nixpacksPlan.phases.install]
cmds = [
  "cd backend && npm ci && cd ..",
  "npm ci"
]

[build.nixpacksPlan.phases.build]
cmds = [
  "cd backend && npm run build:prod && cd ..",
  "npm run build"
]

[deploy]
startCommand = "cd backend && npm start"
healthcheckPath = "/health"
healthcheckTimeout = 200
restartPolicyType = "on_failure"
restartPolicyMaxRetries = 10

# Environment Variables (Railway UI'dan eklenecek):
# - DATABASE_URL (Neon PostgreSQL connection string)
# - JWT_SECRET (min 64 karakter - node -e "console.log(require('crypto').randomBytes(64).toString('hex'))")
# - JWT_EXPIRES_IN=7d
# - NODE_ENV=production
#
# NOT: PORT Railway tarafından otomatik sağlanır, manuel eklemeyin!
# NOT: VITE_API_URL relative path kullanır (/api), build-time'da set edilmeli:
#      Frontend build sırasında: VITE_API_URL=/api npm run build
